name: –û–±—Ä–∞–±–æ—Ç–∫–∞ Markdown —Ñ–∞–π–ª–æ–≤

on:
  schedule:
    - cron: '0 0 * * 1'  # –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
  workflow_dispatch:  # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å workflow –≤—Ä—É—á–Ω—É—é

jobs:
  process-markdown:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Git
        run: |
          git config user.name 'github-actions[bot]'
          git config user.email 'github-actions[bot]@users.noreply.github.com'
        
      - name: –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ docs –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        run: mkdir -p docs

      - name: –û–±—Ä–∞–±–æ—Ç–∫–∞ Markdown —Ñ–∞–π–ª–æ–≤
        run: |
          # –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ markdown —Ñ–∞–π–ª—ã –≤ src –∏ –ø–æ–¥–ø–∞–ø–∫–∞—Ö
          echo "üîç –ü–æ–∏—Å–∫ Markdown —Ñ–∞–π–ª–æ–≤ –≤ src/..."
          mkdir -p tmp_md
          
          # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª
          find src -type f -name "*.md" | while read file; do
            filename=$(basename "$file")
            echo "‚öôÔ∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞: $file"
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ —É–¥–∞–ª—è–µ–º —Å–∫—Ä–∏–ø—Ç–æ–≤—ã–π –±–ª–æ–∫ –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞
            sed '/^<script lang="ts">$/,/^</script>$/d' "$file" > "tmp_md/$filename"
            
            # –ö–æ–ø–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –≤ —Ü–µ–ª–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
            cp "tmp_md/$filename" "docs/$filename"
            
            echo "‚úÖ –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω –∫–∞–∫: docs/$filename"
          done
          
          # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
          rm -rf tmp_md
          
      - name: –ö–æ–º–º–∏—Ç –∏ –ø—É—à –∏–∑–º–µ–Ω–µ–Ω–∏–π
        run: |
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
          if [[ -n $(git status -s docs/) ]]; then
            echo "üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π..."
            git add docs/
            git commit -m "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö Markdown —Ñ–∞–π–ª–æ–≤"
            git push origin HEAD:main
            echo "‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã"
          else
            echo "üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ—Ç, –∫–æ–º–º–∏—Ç –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è"
          fi
